# 数据库初始化说明

## 使用方法

SQLite 数据库会在首次运行时自动创建。数据库文件默认位置为 `database/ai_report.db`。

### 自动初始化

当应用启动时，如果数据库文件不存在，系统会自动：
1. 创建数据库文件
2. 执行 `database/init.sql` 初始化脚本
3. 创建所有表并插入示例数据

### 手动初始化（可选）

如果需要手动初始化数据库，可以使用 SQLite 命令行工具：

```bash
sqlite3 database/ai_report.db < database/init.sql
```

或者在 SQLite 客户端中执行：

```sql
.read database/init.sql
```

### 配置数据库路径

在 `.env` 文件中可以配置数据库路径：

```env
DB_PATH=database/ai_report.db
```

## 数据库结构

- **users**: 用户信息表
- **orders**: 订单表
- **products**: 产品表
- **table_mapping**: 表名映射表（自然语言表名到数据库表名）
- **column_mapping**: 字段映射表（自然语言字段名到数据库字段名）

## 示例数据

脚本会自动插入示例数据，包括：
- 20个用户
- 20个产品
- 40条订单记录

## 性能优化

数据库已创建以下索引以提升查询性能：
- `users` 表：`city`、`age` 字段索引
- `orders` 表：`user_id`、`order_date`、`status` 字段索引
- `products` 表：`category`、`price` 字段索引

## 自然语言映射

系统支持丰富的自然语言到数据库字段的映射，包括：

### 表名映射
- 用户/用户表/客户/客户表 → `users`
- 订单/订单表/购买记录/销售记录 → `orders`
- 产品/产品表/商品/商品表 → `products`

### 字段映射示例
- 用户表：编号/ID/用户编号、姓名/名字/用户名、年龄/岁数、城市/所在城市、创建时间/注册时间
- 订单表：编号/订单编号、用户编号/用户ID、产品名称/商品名称、金额/订单金额/总金额、订单日期/下单日期、状态/订单状态
- 产品表：编号/产品编号、名称/产品名称、分类/类别、价格/单价/售价、库存/库存数量

## 注意事项

- SQLite 数据库文件是单个文件，便于备份和迁移
- 数据库文件会在首次运行时自动创建
- 如果数据库文件已存在，初始化脚本不会重复执行
