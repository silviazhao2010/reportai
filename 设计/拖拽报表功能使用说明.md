# 拖拽报表生成功能使用说明

## 功能概述

拖拽报表生成功能允许用户通过可视化的拖拽界面快速创建和配置报表，支持绑定SQLite数据源，实现灵活的报表设计和数据展示。

## 快速开始

### 1. 安装依赖

首次使用前，需要安装前端依赖（包括新增的react-grid-layout库）：

```bash
npm install
```

### 2. 启动服务

**启动后端服务**:
```bash
python backend/app.py
# 或使用
run_backend.bat
```

**启动前端服务**:
```bash
npm run dev
# 或使用
run_frontend.bat
```

### 3. 访问报表设计器

在浏览器中访问：http://localhost:8080/reports

或者从主页面点击"报表设计器"按钮进入。

## 使用步骤

### 步骤1：创建报表

1. 进入报表设计器页面
2. 点击右上角"创建报表"按钮
3. 进入报表设计界面

### 步骤2：配置基本信息

在左侧边栏填写：
- **报表名称**：必填，用于标识报表
- **报表描述**：可选，用于说明报表用途

### 步骤3：配置数据源

1. **选择数据源**：当前默认使用SQLite数据库
2. **选择数据表**：从下拉列表中选择要查询的数据表
   - 选择表后，系统会自动加载该表的字段信息
3. **添加字段**：
   - 点击"添加字段"按钮
   - 在弹出的选择框中选择要展示的字段
   - 字段会显示在字段列表中，显示格式为：`自然名称 (字段名)`
4. **配置筛选条件**（可选）：
   - 点击"添加筛选条件"按钮
   - 选择字段、操作符（=, !=, >, <, >=, <=, LIKE）和值
   - 可以添加多个筛选条件

### 步骤4：设计报表布局

1. **添加组件**：
   - 从左侧组件库中选择组件类型
   - 点击"数据表格"、"图表"或"文本"按钮添加组件
   - 组件会自动添加到设计区域

2. **调整布局**：
   - 拖拽组件到目标位置
   - 拖拽组件边缘调整大小
   - 组件会自动对齐到网格

3. **删除组件**：
   - 点击组件右上角的删除按钮

### 步骤5：预览报表

1. 点击左侧边栏底部的"预览报表"按钮
2. 系统会根据配置的数据源和查询条件执行查询
3. 在弹窗中查看预览结果

### 步骤6：保存报表

1. 点击左侧边栏底部的"保存报表"按钮
2. 系统会保存报表配置到数据库
3. 保存成功后，可以在报表列表中看到新创建的报表

## 报表管理

### 查看报表列表

在报表设计器主页面，可以看到所有已保存的报表列表，包括：
- ID
- 报表名称
- 描述
- 数据源
- 创建时间
- 更新时间

### 编辑报表

1. 在报表列表中，点击要编辑的报表的"编辑"按钮
2. 进入报表设计界面，所有配置会自动加载
3. 修改配置后，点击"保存报表"按钮

### 删除报表

1. 在报表列表中，点击要删除的报表的"删除"按钮
2. 确认删除操作
3. 报表将被永久删除

## 功能特性

### 拖拽布局

- 使用12列网格系统
- 组件可以自由拖拽和调整大小
- 布局自动保存

### 数据源配置

- 支持SQLite数据库
- 自动加载表结构
- 支持字段别名
- 支持多条件筛选

### 组件类型

当前支持的组件类型：
1. **数据表格**：展示查询结果的数据表格
2. **图表**：数据可视化图表（待完善）
3. **文本**：文本内容展示（待完善）

## 注意事项

1. **数据源配置**：
   - 必须选择数据表
   - 必须至少添加一个字段
   - 筛选条件中的字段和值必须填写完整

2. **布局设计**：
   - 组件可以重叠，但建议避免
   - 组件大小建议根据内容调整
   - 数据表格组件建议使用全宽（12列）

3. **保存和预览**：
   - 保存前建议先预览，确保查询结果正确
   - 保存后可以随时编辑和修改

4. **性能考虑**：
   - 大量数据查询可能较慢，建议添加筛选条件
   - 复杂查询建议优化筛选条件

## 常见问题

### Q: 为什么选择表后看不到字段？
A: 请检查后端服务是否正常运行，以及数据库连接是否正常。

### Q: 预览时提示查询失败？
A: 请检查：
1. 是否选择了数据表
2. 是否添加了字段
3. 筛选条件是否正确填写

### Q: 保存失败怎么办？
A: 请检查：
1. 报表名称是否填写
2. 数据源是否配置完整
3. 后端服务是否正常运行

### Q: 如何删除组件？
A: 点击组件卡片右上角的删除按钮即可。

## 后续功能

以下功能正在规划中：
- 多数据源支持
- 多表JOIN查询
- 图表组件完善
- 报表导出功能
- 报表分享功能

## 技术支持

如有问题或建议，请联系开发团队。

